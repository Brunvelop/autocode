<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autocode - Dynamic API Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: linear-gradient(to bottom right, #eff6ff, #eef2ff);
            min-height: 100vh;
            font-family: system-ui, -apple-system, sans-serif;
        }
        .container {
            max-width: 72rem;
            margin: 0 auto;
            padding: 1.25rem;
        }
        .card {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(0, 0, 0, 0.05);
            margin-bottom: 1.25rem;
        }
        .title {
            font-size: 1.875rem;
            font-weight: bold;
            color: #1f2937;
            text-align: center;
            margin-bottom: 2rem;
        }
        .subtitle {
            text-align: center;
            color: #4b5563;
            margin-bottom: 2rem;
        }
        .loading {
            text-align: center;
            padding: 2.5rem;
            color: #4b5563;
        }
        .functions-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.25rem;
            margin-top: 1.25rem;
        }
        @media (min-width: 1024px) {
            .functions-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        .functions-grid.hidden {
            display: none;
        }
        .info-box {
            margin-top: 1.25rem;
            padding: 1rem;
            background-color: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 0.75rem;
            border: 1px solid rgba(0, 0, 0, 0.05);
            font-size: 0.875rem;
        }
        .info-box strong {
            font-weight: 600;
        }
        .info-box ul {
            margin-top: 0.5rem;
            padding-left: 1.25rem;
            list-style: disc;
        }
        .info-box li {
            margin-top: 0.25rem;
        }
        .info-box code {
            background-color: #f3f4f6;
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-family: monospace;
        }
        .back-link {
            display: flex;
            justify-content: center;
            margin-top: 2rem;
        }
        .btn-back {
            background-color: white;
            color: #4b5563;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.2s, color 0.2s;
            text-decoration: none;
        }
        .btn-back:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            color: #111827;
        }
    </style>
    
    <!-- Custom Elements -->
    <script type="module" src="/elements/chat/index.js"></script>
    <script type="module" src="/elements/auto-element-generator.js"></script>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1 class="title">üöÄ Autocode Framework - Dynamic API Interface</h1>
            <p class="subtitle">Interfaz autom√°tica para todas las funciones expuestas en la API</p>
            
            <div id="loading" class="loading">
                <p>Cargando funciones disponibles...</p>
            </div>
            
            <div id="functionsContainer" class="functions-grid hidden"></div>
            
            <div class="info-box">
                <strong>Arquitectura Din√°mica:</strong>
                <ul class="mt-2 pl-5 list-disc">
                    <li><strong>Auto-detecci√≥n:</strong> La p√°gina consulta <code>/functions/details</code> para obtener todas las funciones disponibles</li>
                    <li><strong>Generaci√≥n din√°mica:</strong> Se crean formularios autom√°ticamente basados en los par√°metros de cada funci√≥n</li>
                    <li><strong>M√©todos flexibles:</strong> Soporte para GET y POST seg√∫n la configuraci√≥n de cada funci√≥n</li>
                    <li><strong>Tipado inteligente:</strong> Inputs apropiados seg√∫n el tipo de cada par√°metro</li>
                    <li><strong>Valores por defecto:</strong> Pre-llenado autom√°tico de par√°metros opcionales</li>
                </ul>
            </div>
        </div>
        
        <div class="back-link">
            <a href="/" class="btn-back">
                ‚Üê Volver al Inicio
            </a>
        </div>
    </div>

    <!-- Chat Element -->
    <autocode-chat></autocode-chat>

    <script type="module">
        class DynamicAPIInterface {
            constructor() {
                this.functions = {};
                this.init();
            }

            async init() {
                try {
                    // Esperar a que el generador se inicialice
                    await this.waitForGenerator();
                    
                    // Cargar funciones para obtener metadata
                    await this.loadFunctions();
                    
                    // Renderizar elementos
                    this.renderFunctions();
                    
                    document.getElementById('loading').classList.add('hidden');
                    document.getElementById('functionsContainer').classList.remove('hidden');
                } catch (error) {
                    console.error('Error loading functions:', error);
                    this.showError('Error cargando las funciones: ' + error.message);
                }
            }

            async waitForGenerator() {
                // Esperar a que autoElementGenerator est√© disponible y inicializado
                let attempts = 0;
                while (!window.autoElementGenerator && attempts < 50) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }
                
                if (!window.autoElementGenerator) {
                    throw new Error('Auto element generator no se carg√≥ correctamente');
                }
                
                console.log('‚úÖ Auto element generator listo');
            }

            async loadFunctions() {
                const response = await fetch('/functions/details');
                if (!response.ok) throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                const data = await response.json();
                this.functions = data.functions;
                console.log('Loaded functions:', this.functions);
            }

            renderFunctions() {
                const container = document.getElementById('functionsContainer');
                container.innerHTML = '';
                
                for (const [funcName, funcInfo] of Object.entries(this.functions)) {
                    const card = document.createElement('div');
                    card.className = 'space-y-4';
                    
                    // Simplemente insertar el auto-element
                    const autoElement = document.createElement(`auto-${funcName}`);
                    card.appendChild(autoElement);
                    
                    container.appendChild(card);
                }
                
                console.log(`‚ú® Renderizados ${Object.keys(this.functions).length} elementos`);
            }

            showError(message) {
                document.getElementById('loading').innerHTML = `
                    <p class="text-red-600">‚ùå ${message}</p>
                    <button onclick="location.reload()" class="mt-2 bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600">Reintentar</button>
                `;
            }
        }

        document.addEventListener('DOMContentLoaded', () => new DynamicAPIInterface());
    </script>
</body>
</html>
