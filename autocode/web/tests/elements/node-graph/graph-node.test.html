<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graph Node - Unit Tests</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-8 bg-gray-100 min-h-screen">
    <div class="flex items-center gap-4 mb-2">
        <a href="/tests" class="text-indigo-600 hover:text-indigo-800">â† Tests</a>
        <h1 class="text-3xl font-bold">ğŸª´ Graph Node - Unit Tests</h1>
    </div>

    <div id="summary" class="mb-6 p-4 bg-white rounded-lg shadow"></div>
    <div id="results" class="space-y-2"></div>

    <script type="module">
        import { TestRunner } from '../../utils/test-runner.js';

        try {
            await import('/elements/node-graph/graph-node.js');
        } catch (e) {
            console.warn('graph-node.js no encontrado:', e.message);
        }

        const runner = new TestRunner();

        runner.group('GraphNode', () => {
            runner.test('Se registra como custom element', async () => {
                await runner.waitForElement('graph-node');
                runner.assertTrue(customElements.get('graph-node'));
            });

            runner.test('Renderiza label e icono por atributo', async (stage) => {
                await runner.waitForElement('graph-node');
                const el = document.createElement('graph-node');
                el.setAttribute('label', 'src');
                el.setAttribute('icon', 'ğŸ“');
                stage.appendChild(el);

                await runner.sleep(10);

                const label = el.querySelector('.label');
                const bubble = el.querySelector('.bubble');

                runner.assertTrue(label.textContent.includes('src'), 'El label debe renderizarse');
                runner.assertTrue(bubble.textContent.includes('ğŸ“'), 'El icono debe renderizarse');
            });

            runner.test('Aplica variantes de estilo (type="root" | "directory")', async (stage) => {
                await runner.waitForElement('graph-node');
                const el = document.createElement('graph-node');
                el.setAttribute('type', 'root');
                // Simulamos depth 0 para root
                el.setAttribute('depth', '0');
                stage.appendChild(el);

                await runner.sleep(10);
                const bubble = el.querySelector('.bubble');

                // Para root/depth 0 usa w-24 h-24
                runner.assertTrue(bubble.classList.contains('w-24'), 'Debe aplicar tamaÃ±o grande para depth 0');
                runner.assertTrue(bubble.classList.contains('border-green-500'), 'Debe aplicar color verde para type root');
            });

            runner.test('Emite eventos custom al hacer click', async (stage) => {
                await runner.waitForElement('graph-node');
                const el = document.createElement('graph-node');
                el.dataset.id = 'node-123';
                el.setAttribute('type', 'file');
                stage.appendChild(el);

                let clickedDetail = null;
                el.addEventListener('node-click', (e) => clickedDetail = e.detail);

                el.click(); // Dispatch click nativo
                
                runner.assertTrue(clickedDetail, 'Debe emitir evento node-click');
                runner.assertEqual(clickedDetail.id, 'node-123', 'Detail debe incluir ID');
                runner.assertEqual(clickedDetail.type, 'file', 'Detail debe incluir type');
            });
        });

        runner.run();
    </script>
</body>
</html>
